<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App</title>
</head>
<body>

<h2>Chat Application</h2>

<input type="text" id="msgInput" placeholder="Enter message">
<button onclick="sendText()">Send Text</button>

<br><br>

<input type="file" id="fileInput">
<button onclick="sendFile()">Send Image / Video / PDF</button>

<hr>

<div id="msgBox"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io(window.location.origin);
    const msgBox = document.getElementById('msgBox');

    function sendText() {
        const msg = msgInput.value;
        if (!msg) return;
        socket.emit('msgFromFrontend', msg);
        msgInput.value = '';
    }

    async function sendFile() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);

        const res = await fetch('/upload', {
            method: 'POST',
            body: formData
        });

        const data = await res.json();
        socket.emit('fileMessage', data);
        document.getElementById('fileInput').value = '';
    }

    socket.on('msgFromBackend', (data) => {

        // TEXT
        if (data.type === 'text') {
            const p = document.createElement('p');
            p.innerText = data.msg;
            msgBox.appendChild(p);
            return;
        }

        const container = document.createElement('div');
        container.style.margin = '10px 0';

        // IMAGE
        if (data.fileType.startsWith('image')) {
            const img = document.createElement('img');
            img.src = data.fileUrl;
            img.width = 200;
            img.style.display = 'block';

            const download = document.createElement('a');
            download.href = data.fileUrl;
            download.download = data.fileName;
            download.innerText = 'â¬‡ Download Image';

            container.appendChild(img);
            container.appendChild(download);
        }

        // VIDEO
        else if (data.fileType.startsWith('video')) {
            const video = document.createElement('video');
            video.src = data.fileUrl;
            video.controls = true;
            video.width = 300;
            video.style.display = 'block';

            const download = document.createElement('a');
            download.href = data.fileUrl;
            download.download = data.fileName;
            download.innerText = 'â¬‡ Download Video';

            container.appendChild(video);
            container.appendChild(download);
        }

        // PDF âœ…
        else if (data.fileType === 'application/pdf') {
            const pdfText = document.createElement('p');
            pdfText.innerText = `ðŸ“„ ${data.fileName}`;

            const view = document.createElement('a');
            view.href = data.fileUrl;
            view.target = '_blank';
            view.innerText = 'View PDF';

            const download = document.createElement('a');
            download.href = data.fileUrl;
            download.download = data.fileName;
            download.style.marginLeft = '10px';
            download.innerText = 'â¬‡ Download PDF';

            container.appendChild(pdfText);
            container.appendChild(view);
            container.appendChild(download);
        }

        msgBox.appendChild(container);
    });
</script>

</body>
</html>
